define("install",["require"],function(e){function t(){var e=t[t.type+"Install"];e?e():t.trigger("error","unsupported install: "+t.type)}function n(e){t.state=e,t.trigger("change",t.state)}t.state="unknown",t.check=function(){var e=navigator.mozApps,r;navigator.mozApps?(t.type="mozilla",r=navigator.mozApps.getSelf(),r.onsuccess=function(){this.result?n("installed"):n("uninstalled")},r.onerror=function(e){t.error=e,n("error")}):typeof chrome!="undefined"&&chrome.webstore&&chrome.app?(t.type="chromeStore",chrome.app.isInstalled?n("installed"):n("uninstalled")):typeof window.navigator.standalone!="undefined"?(t.type="ios",window.navigator.standalone?n("installed"):n("uninstalled")):(t.type="unsupported",n("unsupported"))},t.mozillaInstallUrl=location.href+"manifest.webapp",t.mozillaInstall=function(){var e=navigator.mozApps.install(t.mozillaInstallUrl);e.onsuccess=function(e){n("installed")},e.onerror=function(e){t.error=e,n("error")}},t.chromeInstallUrl=null,t.chromeInstall=function(){chrome.webstore.install(t.chromeInstallUrl,function(){n("installed")},function(e){t.error=e,n("error")})},t.iosInstall=function(){t.trigger("showiOSInstall",navigator.platform.toLowerCase())};var r={};return t.on=function(e,t){r[e]=(r[e]||[]).concat([t])},t.off=function(e,t){if(r[e]){var n=[];for(var i=0,s=r[e].length;i<s;i++){var o=r[e][i];o!=t&&n.push()}r[e]=n}},t.trigger=function(e){var t=Array.prototype.slice.call(arguments,1);if(r[e])for(var n=0,i=r[e].length;n<i;n++)r[e][n].apply(this,t)},t.check(),t}),define("../install-button",["require","install"],function(e){function n(){var e=document.getElementById("install-btn");if(t.state=="uninstalled")e.style.display="block";else if(t.state=="installed"||t.state=="unsupported")e.style.display="none"}function r(){var e=document.getElementById("install-btn");e.addEventListener("click",function(){t()}),t.on("change",n),t.on("error",function(e,t){alert("There was an error during installation.")}),t.on("showiOSInstall",function(){alert('To install, press the forward arrow in Safari and touch "Add to Home Screen"')})}var t=e("install");document.getElementById("install-btn")?r():document.addEventListener("DOMContentLoaded",r)}),define("../math",["require"],function(e){function i(e,t,n){return Math.max(Math.min(e,n),t)}var t=typeof Float32Array!="undefined"?Float32Array:Array,n=1e-6,r={};r.create=function(e){var n=new t(2);return e?(n[0]=e[0],n[1]=e[1]):n[0]=n[1]=0,n},r.createFrom=function(e,n){var r=new t(2);return r[0]=e,r[1]=n,r},r.set=function(e,t){return t[0]=e[0],t[1]=e[1],t},r.equal=function(e,t){return e===t||Math.abs(e[0]-t[0])<n&&Math.abs(e[1]-t[1])<n},r.add=function(e,t,n){return!n||e===n?(e[0]+=t[0],e[1]+=t[1],e):(n[0]=e[0]+t[0],n[1]=e[1]+t[1],n)},r.subtract=function(e,t,n){return!n||e===n?(e[0]-=t[0],e[1]-=t[1],e):(n[0]=e[0]-t[0],n[1]=e[1]-t[1],n)},r.multiply=function(e,t,n){return!n||e===n?(e[0]*=t[0],e[1]*=t[1],e):(n[0]=e[0]*t[0],n[1]=e[1]*t[1],n)},r.scale=function(e,t,n){return!n||e===n?(e[0]*=t,e[1]*=t,e):(n[0]=e[0]*t,n[1]=e[1]*t,n)},r.length=function(e){var t=e[0],n=e[1];return Math.sqrt(t*t+n*n)},r.str=function(e){return"["+e[0]+", "+e[1]+"]"},r.normalize=function(e,t){t||(t=e);var n=e[0],r=e[1],i=Math.sqrt(n*n+r*r);if(!i)t[0]=0,t[1]=0;else if(i===1)return t[0]=n,t[1]=r,t;return i=1/i,t[0]=n*i,t[1]=r*i,t},window.vec2=r,window.bound=i}),define("../resources",["require"],function(e){function i(e){e instanceof Array?e.forEach(function(e){s(e)}):s(e)}function s(e){if(t[e])return t[e];var n=new Image;n.onload=function(){t[e]=n,u()&&r.forEach(function(e){e()})},t[e]=!1,n.src=e}function o(e){return t[e]}function u(){var e=!0;for(var n in t)t.hasOwnProperty(n)&&!t[n]&&(e=!1);return e}function a(e){r.push(e)}var t={},n=[],r=[];return{load:i,get:o,onReady:a,ready:u}}),define("../input",["require","./math"],function(e){function t(e){e.preventDefault()}function o(e,t){var n=e.keyCode;n in i?r[i[n]]=t:r[String.fromCharCode(n)]=t}function u(e){return n?!1:r[e.toUpperCase()]}function a(){return n?!1:u("SPACE")}function f(){n=!0}function l(){n=!1}function c(){var e=document.querySelector(".dpad"),t;e.addEventListener("touchstart",function(n){n.preventDefault();var r=n.changedTouches[0];t=[r.clientX,r.clientY],e.style.backgroundColor="#ccf"},!0),e.addEventListener("touchmove",function(n){n.preventDefault();var i=n.changedTouches[0],s=[i.clientX,i.clientY];r.LEFT=!1,r.UP=!1,r.RIGHT=!1,r.DOWN=!1;var o=vec2.create();vec2.subtract(s,t,o),vec2.normalize(o);var u=[0,1],a=Math.atan2(o[1],o[0])/Math.PI*180;a=-a,a<0&&(a=360-Math.abs(a));if(a>290||a<70)r.RIGHT=!0;a>20&&a<160&&(r.UP=!0),a>110&&a<250&&(r.LEFT=!0),a>200&&a<340&&(r.DOWN=!0)},!0),e.addEventListener("touchend",function(n){r.LEFT=!1,r.UP=!1,r.RIGHT=!1,r.DOWN=!1,e.style.backgroundColor="#fcc"},!0)}function h(){function t(t){t.preventDefault(),r.SPACE=!0,e.style.backgroundColor="#ccf"}function n(t){t.preventDefault(),r.SPACE=!1,e.style.backgroundColor="#fcc"}c();var e=document.getElementsByClassName("fire")[0];e.addEventListener("touchstart",t,!1),e.addEventListener("touchend",n,!1),e.addEventListener("touchleave",n,!1),e.addEventListener("touchcancel",n,!1)}e("./math");var n=!1,r={},i={32:"SPACE",37:"LEFT",38:"UP",39:"RIGHT",40:"DOWN"},s={FIRE:!1};return window.addEventListener("touchmove",t,!0),document.addEventListener("keydown",function(e){o(e,!0)}),document.addEventListener("keyup",function(e){o(e,!1)}),{init:h,setKey:o,isDown:u,isFiring:a,disable:f,enable:l}}),define("../object",[],function(){function e(t,n,r){var i=Object.create(t.prototype),s=/xyz/.test(function(){xyz})?/\bparent\b/:/.*/;r=r||{};for(var o in r){var u=r[o],a=i[o];typeof a=="function"&&typeof u=="function"&&s.test(u)?i[o]=function(e,t){return function(){var n=this.parent;this.parent=t;var r=e.apply(this,arguments);return this.parent=n,r}}(u,a):i[o]=u}i.typename=n;var f=function(){i.init&&i.init.apply(this,arguments)};return f.prototype=i,f.prototype.constructor=f,f.extend=function(t,n){return typeof t=="object"&&(n=t,t="anonymous"),e(f,t,n)},f}return e(Object,"Object",{})}),define("../sceneobject",["require","./object"],function(e){var t=e("./object");return t.extend({init:function(e,t,n){this.pos=vec2.create(e||[0,0]),this.size=vec2.create(t||[1,1]),this.sprite=n},update:function(e){this.sprite&&this.sprite.update(e)},render:function(e){this.sprite?this.sprite.render(e):this.color&&(e.fillStyle=this.color,e.fillRect(0,0,this.size[0],this.size[1]))},remove:function(){this._scene&&this._scene.removeObject(this)},isRemoved:function(){return this._sceneRemove}})}),define("../sprite",["require","./resources"],function(e){function n(e,t,n,r,i,s,o){this.pos=t,this.size=n,this.speed=typeof r=="number"?r:0,this.frames=i,this._index=0,this.url=e,this.dir=s||"horizontal",this.once=o}var t=e("./resources");return n.prototype={flipHorizontal:function(e){this.flipHoriz=e},setOffset:function(e){this.offset=e},randomize:function(){return this.speed>0&&(this._index+=Math.random()*this.frames.length*.2),this},clone:function(){return new n(this.url,[this.pos[0],this.pos[1]],[this.size[0],this.size[1]],this.speed,this.frames&&this.frames.slice(),this.dir,this.once)},update:function(e){this._index+=this.speed*e},render:function(e){var n;if(this.speed>0){var r=this.frames.length,i=Math.floor(this._index);n=this.frames[i%r];if(this.once&&i>=r){this.done=!0;return}}else n=0;var s=this.pos[0],o=this.pos[1];this.dir=="vertical"?o+=n*this.size[1]:s+=n*this.size[0];var u=this.offset||[0,0];this.flipHoriz&&e.scale(-1,1),e.drawImage(t.get(this.url),s,o,this.size[0],this.size[1],u[0],u[1],this.size[0],this.size[1])}},n}),define("../units",["require","./sceneobject","./sprite","./input","./resources"],function(e){var t=e("./sceneobject"),n=e("./sprite"),r=e("./input"),i=e("./resources"),s=t.extend({init:function(e,t){this.parent(t,[27,19]),this._renderer=e,this.lastShot=0,this.score=0,this._scoreEl=document.querySelector(".score span"),this._lifeEl=document.querySelector(".life span"),this.weapons=[],this.life=3,this.sprites={"default":new n("img/sprites.png",[0,238],[27,23]),up:new n("img/sprites.png",[0,192],[27,23]),down:new n("img/sprites.png",[0,284],[27,23])},this._lifeEl.textContent=this.life,this.sprite=this.sprites["default"]},update:function(e){var t=this._scene.camera;this.sprite=this.sprites["default"],t.pos[0]<1950&&(this.pos[0]+=20*e);if(r.isDown("w")||r.isDown("UP"))this.pos[1]-=250*e,this.sprite=this.sprites.up;if(r.isDown("a")||r.isDown("LEFT"))this.pos[0]-=250*e;if(r.isDown("s")||r.isDown("DOWN"))this.pos[1]+=250*e,this.sprite=this.sprites.down;if(r.isDown("d")||r.isDown("RIGHT"))this.pos[0]+=250*e;r.isFiring()&&this.shoot();var n=this._scene.camera.pos[0],i=this._renderer.width+n-this.size[0],s=this._renderer.height-this.size[1];this.pos[0]=bound(this.pos[0],n,i),this.pos[1]=bound(this.pos[1],0,s),this._scoreEl.textContent=this.score,this.parent(e)},shoot:function(){var e=this._scene,t=[this.pos[0]+this.size[0],this.pos[1]+this.size[1]/2-E.laser.sprite.size[1]/2],n=[this.pos[0]+this.size[0]/2-E.laser.sprite.size[1]/2,this.pos[1]+this.size[1]/2];if(Date.now()-this.lastShot>100){e.addObject(new u(this._renderer,vec2.create(t),[1,0],1e3));for(var r=0;r<this.weapons.length;r++){var i=this.weapons[r];if(i=="multi")for(var s=0;s<5;s++)e.addObject(new u(this._renderer,vec2.createFrom(t[0],t[1]+Math.random()*50-25),[1,0],1e3));else i=="side"&&(e.addObject(new u(this._renderer,vec2.createFrom(n[0],n[1]-this.sprite.size[1]),[0,-1],1e3,E.upLaser)),e.addObject(new u(this._renderer,vec2.createFrom(n[0],n[1]+this.sprite.size[1]),[0,1],1e3,E.downLaser)))}this.lastShot=Date.now()}},hit:function(e){this.life--,this._lifeEl.textContent=this.life,this._scene.addObject(new o(this.pos)),this.life<=0&&(this.remove(),this._scene.addObject(new g(this.pos)),this.gameOver=!0)},incrementScore:function(e){this.score+=e,this.score<0&&(this.score=0)},collide:!0,id:"player"}),o=t.extend({init:function(e){this.parent(null,null,new n("img/sprites.png",[64,128],[55,55])),this.started=Date.now()},update:function(e){if(Date.now()-this.started>1300)this.remove();else{var t=this._scene.getObject("player").pos;this.pos=vec2.createFrom(t[0]-15,t[1]-18)}},render:function(e){var t=e.globalAlpha;e.globalAlpha=Math.max(1-(Date.now()-this.started)/1300,0),this.parent(e),e.globalAlpha=t}}),u=t.extend({init:function(e,t,n,r,i){i=i||E.laser,this.parent(t,i.bounds,i.sprite.clone()),this._renderer=e,this.dir=vec2.normalize(n||[1,0]),this.speed=r||300},update:function(e){var t=this.speed;this.pos[0]+=this.dir[0]*t*e,this.pos[1]+=this.dir[1]*t*e;var n=this._scene.camera.pos,r=this.pos,i=this.size,s=this._renderer.width,o=this._renderer.height;(r[0]<n[0]-i[0]||r[0]>n[0]+s||r[1]<n[1]-i[1]||r[1]>n[1]+o)&&this.remove()},onCollide:function(e){if(e instanceof f){e.hit(),this.remove();if(e.isDead()){var t=this._scene.getObject("player");t&&t.incrementScore(e.points)}}},collide:!0}),a=u.extend({init:function(e,t,n,r){this.parent(e,t,n,r),this.sprite.flipHorizontal(!0)},onCollide:function(e){e instanceof s&&!this.isRemoved()&&(e.hit(this),this.remove())},collide:!0}),f=t.extend({init:function(e,t,n,r,i){this._renderer=e,this.components=i,this.life=1,this.parent(t,n,r)},update:function(e){this.parent(e);if(this.components){var t=this.components;for(var n=0,r=t.length;n<r;n++)t[n].call(this)}this.pos[0]<this._scene.camera.pos[0]-this.size[0]&&this.remove()},hit:function(){this.life--;if(this.life<=0){this.remove(),this.dead=!0;var e=E.explosion.sprite.size[1]-this.sprite.size[1],t=[this.pos[0],this.pos[1]];t[1]-=e/2,this._scene.addObject(new g(t))}},isDead:function(){return this.dead},onCollide:function(e){e instanceof s&&(e.hit(this),this.hit())},points:0}),l=f.extend({points:300,id:"boss",init:function(e,t){this.parent(e,t,[172,98],new n("img/sprites.png",[32,256],[172,98])),this.life=50,this.startY=t[1],this.age=0},hit:function(){}}),c=f.extend({points:1e3,init:function(e,t,r){this.parent(e,t,[42,42]),this.dirFunc=r,this.life=1e3,this.normalSprite=new n("img/sprites.png",[224,256],[42,42]),this.hitSprite=new n("img/sprites.png",[224,320],[42,42]),this.sprite=this.normalSprite},update:function(e){var t=this._scene,n=this._renderer;Math.random()<.03&&t.addObject(new v(n,E.fireball,[this.pos[0],this.pos[1]],this.dirFunc()))},render:function(e){this.collided&&(this.sprite=this.hitSprite),this.parent(e),this.collided&&(this.sprite=this.normalSprite,this.collided=!1)},onCollide:function(e){e instanceof u&&(this.collided=!0)}}),h=t.extend({init:function(e){this.parent(e,[200,98],new n("img/sprites.png",[352,128],[32,194])),this.sprite.setOffset([0,-50])},onCollide:function(e){e instanceof u&&!(e instanceof a)&&(this.lastHit=Date.now(),e.remove())},render:function(e){var t=Date.now();if(this.lastHit&&t-this.lastHit<700){var n=e.globalAlpha;e.globalAlpha=1-(t-this.lastHit)/700,this.parent(e),e.globalAlpha=n}}}),p=f.extend({points:100,init:function(e,t,n,r,i){this.parent(e,n,t.bounds,t.sprite.clone(),r),this.age=i||0,this.startingPos=[this.pos[0],this.pos[1]]},update:function(e){this.parent(e),this.age+=e,this.startingPos[0]-=20*e,this.pos[0]=this.startingPos[0]+Math.sin(this.age*1.5)*100,this.pos[1]=this.startingPos[1]+Math.cos(this.age*1.5)*100}}),d=f.extend({points:100,init:function(e,t,n,r,i){this.parent(e,n,t.bounds,t.sprite.clone(),r),this.age=i||0,this.startingPos=[this.pos[0],this.pos[1]]},update:function(e){this.parent(e),this.age+=e,this.pos[0]-=75*e,this.pos[1]=this.startingPos[1]+Math.sin(this.age*3)*50}}),v=f.extend({points:0,init:function(e,t,n,r){this.parent(e,n,t.bounds,t.sprite.clone()),this.dir=r},update:function(e){this.parent(e),this.pos[0]+=this.dir[0]*e,this.pos[1]+=this.dir[1]*e}}),m=f.extend({points:100,init:function(e,t,n,r,i,s){this.parent(e,n,t.bounds,t.sprite.clone(),r),this.age=s||0,this.speed=i||20,this.pos[1]<e.height/2?this.dir="up":this.dir="down"},update:function(e){this.sprite.update(e),this.age+=e,this.dir=="down"?this.pos[1]-=this.speed*e:this.pos[1]+=this.speed*e}}),g=t.extend({init:function(e){this.parent(e,null,E.explosion.sprite.clone().randomize())},update:function(e){this.sprite.update(e),this.sprite.done&&this.remove()}}),y=t.extend({collide:!0,init:function(e,t,r){this.parent(t,[16,16],new n("img/sprites.png",[0,128],[16,16],6,[0,1,2,1,0])),this.type=r},onCollide:function(e){e instanceof s&&(e.weapons.push(this.type),this.remove())}}),b=t.extend({init:function(e,t){this.imgName=t;var n=i.get(this.imgName),r=[e.width+n.width,e.height];this.parent(null,r);var s=this;e.onResize(function(e,t){s.size[0]=e+n.width,s.size[1]=t})},update:function(e){var t=this._scene.camera,n=i.get(this.imgName);t.pos[0]<1950&&(this.imgName=="img/background2.png"?this.pos[0]-=15*e:this.imgName=="img/background3.png"&&(this.pos[0]-=30*e));var r=this._scene.getScreenPos(this.pos),s=this.size[0];r[0]<-n.width&&(this.pos[0]+=-r[0])},render:function(e){this.pattern||(this.pattern=e.createPattern(i.get(this.imgName),"repeat")),e.fillStyle=this.pattern,e.fillRect(0,0,this.size[0],this.size[1])}}),w=t.extend("Trigger",{collide:!0,init:function(e,t,n,r){this.parent([t,0],[n-t,e.height]),this.func=r;var i=this;e.onResize(function(e,t){i.size[1]=t})},onCollide:function(e){e instanceof s&&this.func()}}),E={fireShip:{bounds:[24,21],sprite:new n("img/sprites.png",[32,192],[24,21],6,[0,1],"vertical")},metalShip:{bounds:[24,22],sprite:new n("img/sprites.png",[0,0],[24,22],6,[0,1,2,1])},fireball:{bounds:[56,42],sprite:new n("img/sprites.png",[288,128],[56,42],15,[0,1,2,3],"vertical")},saw:{bounds:[49,49],sprite:new n("img/sprites.png",[64,192],[49,49],24,[0,1,2,3])},explosion:{bounds:[1,1],sprite:new n("img/sprites.png",[0,64],[39,39],16,[0,1,2,3,4,5,6,7,8,9,10,11,12],null,!0)},laser:{bounds:[11,4],sprite:new n("img/sprites.png",[0,32],[11,4])},upLaser:{bounds:[14,9],sprite:new n("img/sprites.png",[32,32],[14,9])},downLaser:{bounds:[14,9],sprite:new n("img/sprites.png",[32,41],[14,9])}};return{Player:s,Laser:u,EnemyLaser:a,Enemy:f,Boss:l,BossWeakness:c,BossShield:h,CircleEnemy:p,SineEnemy:d,StraightEnemy:v,SurpriseEnemy:m,Explosion:g,Floor:b,Trigger:w,Powerup:y,sprites:E}}),define("../level",["require","./units"],function(e){function r(e,t){return e.camera.pos[0]+t.width}function i(e,t,n,i){var s=t.height;return n=n||0,i=i||1,[r(e,t),s*n+Math.random()*s*(i-n)]}function s(e,n){e.addObject(new t.Floor(n,"img/background.png")),e.addObject(new t.Floor(n,"img/background2.png")),e.addObject(new t.Floor(n,"img/background3.png")),o(e,n);var r=new t.Player(n,[50,50]);e.addObject(r)}function o(e,s){e.addObject(new t.Trigger(s,0,500,function(){var r=Math.random();r<.01&&e.addObject(new t.SineEnemy(s,n.fireShip,i(e,s),[f(1.5)]))})),e.addObject(new t.Trigger(s,500,1200,function(){var r=Math.random(),o=s.height,u=e.getObject("player");r<.03?e.addObject(new t.SineEnemy(s,n.saw,i(e,s))):r<.05&&e.addObject(new t.SineEnemy(s,n.fireShip,i(e,s)))})),e.addObject(new t.Trigger(s,1e3,1700,function(){var t=Math.random();t<.01&&u(s,e,6)})),e.addObject(new t.Trigger(s,1300,1900,function(){var i=Math.random();i<.05&&e.addObject(new t.SurpriseEnemy(s,n.saw,[r(e,s)-Math.random()*s.width,Math.random()<.5?-n.saw.sprite.size[1]:s.height]))})),e.addObject(new t.Powerup(s,[1100,s.height*.3],"multi")),e.addObject(new t.Powerup(s,[1600,s.height*.6],"side")),e.addObject(new t.Trigger(s,1950,2e3,function(){e.getObject("boss")||(a(s,e),this.remove())}))}function u(e,r,s){for(var o=0;o<s;o++){var u=Math.random()*50;r.addObject(new t.CircleEnemy(e,n.metalShip,i(r,e,.3,.7),[f(4)],o/5))}}function a(e,r){var s=new t.Boss(e,[2250,110]),o=new t.BossWeakness(e,[2250,235],function(){return[-100,Math.random()*-100]}),u=new t.BossWeakness(e,[2250,50],function(){return[-100,Math.random()*100]});r.addObject(s),r.addObject(o),r.addObject(u),r.addObject(new t.BossShield([2200,110])),r.addObject(new t.Trigger(e,1950,e.width+1950,function(){var a=o.life+u.life,l=Math.random();a<1800&&l<.03&&r.addObject(new t.SineEnemy(e,n.fireShip,i(r,e),[f(1.5)])),a<1e3&&l<.05&&r.addObject(new t.SineEnemy(e,n.saw,i(r,e)));if(a<=0){this.remove(),s.remove();for(var c=0;c<10;c++)r.addObject(new t.Explosion([2250+Math.random()*100,110+Math.random()*100]));var h=r.getObject("player");h.gameWon=!0,h.remove()}}))}function f(e){return function(){if(this.lastShot===undefined){this.lastShot=Date.now()-e*1e3+Math.floor(Math.random()*2e3);return}var n=Date.now();n-this.lastShot>e*1e3&&(this._scene.addObject(new t.EnemyLaser(this._renderer,[this.pos[0],this.pos[1]+this.size[1]/2],[-1,0],300)),this.lastShot=n)}}var t=e("./units"),n=t.sprites;return{init:s}});var requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)}}();define("../renderer",["require","./object"],function(e){var t=e("./object");return t.extend({init:function(){var e=document.getElementById("canvas"),t=document.getElementById("size-wrapper");this.ctx=e.getContext("2d"),this.canvas=e,this.resizeFuncs=[],this.optimizeSize(e,t);var n=this;window.onresize=function(){n.optimizeSize(e,t)},window.onresize()},optimizeSize:function(e,t){if(window.innerWidth<=600&&window.innerHeight<=600)this.width=e.width=window.innerWidth,this.height=e.height=window.innerHeight,t.style.width=this.width+"px",t.style.height=this.height+"px",document.body.className="small";else{var n=window.innerWidth/window.innerHeight;this.width=e.width=480,this.height=e.height=320;var r=Math.min(Math.floor(window.innerWidth/480)||1,Math.floor(window.innerHeight/320)||1);t.style.width=this.width*r+"px",t.style.height=this.height*r+"px",r==1?document.body.className="small":document.body.className=""}this.fireResize()},onResize:function(e){this.resizeFuncs.push(e)},fireResize:function(){for(var e=0,t=this.resizeFuncs.length;e<t;e++)this.resizeFuncs[e](this.width,this.height)},render:function(e){if(!e.camera){console.log("WARNING! No camera in the scene, so nothing will be displayed.");return}var t=this.ctx;t.setTransform(1,0,0,1,0,0),t.fillStyle="black",t.fillRect(0,0,this.width,this.height),e.camera.prerender(t);var n=e.objects;for(var r=0,i=n.length;r<i;r++){var s=n[r];t.save(),t.translate(s.pos[0],s.pos[1]),t.fillStyle="pink",s.render(t),t.restore()}},debug:function(e,t){if(!e.camera){console.log("WARNING! No camera in the scene, so nothing will be displayed.");return}var n=this.ctx;n.setTransform(1,0,0,1,0,0),n.strokeStyle="red",e.camera.prerender(n);var r=e.objects;for(var i=0,s=r.length;i<s;i++){var o=r[i];t?t==o.typename&&n.strokeRect(o.pos[0],o.pos[1],o.size[0],o.size[1]):n.strokeRect(o.pos[0],o.pos[1],o.size[0],o.size[1])}}})}),define("../scene",["require","./object"],function(e){function n(e,t,n,r,i,s,o,u){return!(n<=i||e>o||r<=s||t>u)}var t=e("./object");return t.extend({init:function(e){this.objects=[],this.objectsById={},this.camera=e,this.addedObjects=[]},addObject:function(e){this.addedObjects.push(e),e.id&&(this.objectsById[e.id]=e)},getObject:function(e){return this.objectsById[e]},removeObject:function(e){e._sceneRemove=!0},getScreenPos:function(e){var t=vec2.create();return vec2.subtract(e,this.camera.pos,t),t},update:function(e){this.camera.update(e);var t=[],n=this.objects;for(var r=0,i=n.length;r<i;r++)n[r].update(e),n[r]._sceneRemove||t.push(n[r]);this.objects=t;var s=this.addedObjects;for(var r=0,i=s.length;r<i;r++){var o=s[r];this.objects.push(o),o._scene=this}this.addedObjects=[],this.checkCollisions()},checkCollisions:function(){var e=this.objects;for(var t=0,n=e.length;t<n;t++)e[t]&&e[t].collide&&this.checkObjCollisions(e[t])},checkObjCollisions:function(e){var t=this.objects;for(var r=0,i=t.length;r<i;r++){var s=e.pos,o=e.size;if(t[r]&&t[r]!=e){var u=t[r],a=u.pos,f=u.size;n(s[0],s[1],s[0]+o[0],s[1]+o[1],a[0],a[1],a[0]+f[0],a[1]+f[1])&&(e.onCollide&&e.onCollide(u),u.onCollide&&u.onCollide(e))}}}})}),define("../camera",["require","./sceneobject"],function(e){var t=e("./sceneobject");return t.extend({update:function(e){this.pos[0]<1950&&(this.pos[0]+=20*e)},prerender:function(e){e.translate(-this.pos[0],-this.pos[1])}})}),define("../app",["require","./install-button","./math","./resources","./input","./level","./renderer","./scene","./camera"],function(e){function c(e){return document.getElementById(e)}function h(e){return Array.prototype.slice.call(document.querySelectorAll(e))}function p(){var e=document,t=e.body,n=e.fullscreenElement||e.mozFullScreenElement||e.webkitFullscreenElement;n?e.cancelFullScreen?e.cancelFullScreen():e.mozCancelFullScreen?e.mozCancelFullScreen():e.webkitCancelFullScreen&&e.webkitCancelFullScreen():t.requestFullScreen?t.requestFullScreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullScreen()&&t.webkitRequestFullScreen()}function d(){c("game-over").style.display="block",c("game-over-overlay").style.display="block",h("#game-over .message")[0].textContent="GAME OVER!",h(".button").forEach(function(e){e.style.display="none"}),n.disable()}function v(){d(),h("#game-over .message")[0].textContent="ENEMY DEFEATED!"}function m(){c("game-over").style.display="none",c("game-over-overlay").style.display="none",h(".button").forEach(function(e){e.style.display="block"}),c("continue").style.display="none",f&&g(),n.enable(),y(!0)}function g(){f?(f=!1,c("continue").style.display="none",c("pause").style.display="block",b=Date.now(),requestAnimFrame(w)):(f=!0,c("pause").style.display="none",c("continue").style.display="block")}function y(e){var t=new o([0,0]);u=new i,a=new s(t),r.init(a,u),e||(n.init(),c("play-again").addEventListener(l,m),c("pause").addEventListener(l,g),c("continue").addEventListener(l,g),c("restart").addEventListener(l,m),document.addEventListener("keyup",function(e){String.fromCharCode(e.keyCode)=="P"&&g()}),c("fullscreen").addEventListener("click",p),w())}function w(){b||(b=Date.now());var e=Date.now(),t=(e-b)/1e3;a.update(t),u.render(a),a.getObject("player").gameOver?d():a.getObject("player").gameWon&&v(),f||(b=e,requestAnimFrame(w))}e("./install-button"),e("./math");var t=e("./resources"),n=e("./input"),r=e("./level"),i=e("./renderer"),s=e("./scene"),o=e("./camera"),u,a,f=!1,l="ontouchstart"in window?"touchstart":"click",b;t.load(["img/sprites.png","img/background.png","img/background2.png","img/background3.png"]),t.onReady(y)})